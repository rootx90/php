# الدوال في PHP مبسطة مع أمثلة واقعية

في PHP، تُعتبر الدوال (Functions) مثل وصفات الطبخ؛ حيث تُجمع مجموعة من التعليمات البرمجية في "وصفة" واحدة يمكن إعادة استخدامها مرارًا وتكرارًا. بهذه الطريقة، لا تحتاج إلى كتابة نفس الكود مرة بعد مرة، بل تقوم بتعريف الدالة مرة واحدة ثم تستدعيها عند الحاجة.

---

## 1. ما هي الدالة؟

**الدالة** هي كتلة من الكود تؤدي مهمة محددة، وهي تشبه وصفة الطبخ:
- **المكونات (المدخلات):** مثل المتغيرات أو المعاملات التي تُمرر إلى الدالة.
- **خطوات التحضير (كود الدالة):** التعليمات التي تُنفذ داخل الدالة.
- **النتيجة (المخرجات):** القيمة التي تُعيدها الدالة (إذا استدعت ذلك).

**مثال بسيط:**  
دالة لصنع الشاي:
```php
function makeTea($sugar = 1) {
    echo "أضف الماء، ضع الشاي، أضف $sugar ملعقة سكر، قلب جيدًا.";
}
makeTea(2); // يطبع: أضف الماء، ضع الشاي، أضف 2 ملعقة سكر، قلب جيدًا.
```

---

## 2. أنواع الدوال في PHP

### أ. الدوال العادية (Named Functions)
- **ما هي؟**  
  دوال تُعرف باسم ثابت وتُكتب باستخدام الكلمة المفتاحية `function`. تُشبه وصفة مكتوبة في كتاب الطبخ.
  
- **مثال واقعي:**  
  حساب إجمالي سعر المنتج مع الضريبة:
  ```php
  function calculateTotal($price, $tax = 0.15) {
      return $price * (1 + $tax);
  }
  echo calculateTotal(100); // يطبع: 115 (أي 100 + 15% ضريبة)
  ```

- **متى تستخدمها؟**  
  عندما تكون المهمة كبيرة أو تُستخدم في أماكن متعددة داخل البرنامج.

---

### ب. الدوال المجهولة (Anonymous Functions / Closures)
- **ما هي؟**  
  دوال بدون اسم يتم تخزينها في متغير أو تمريرها كوسيلة (Callback). تشبه وصفة مكتوبة على ورقة تستخدم لمرة واحدة.
  
- **مثال واقعي:**  
  عرض رسالة ترحيب مخصصة:
  ```php
  $welcomeMessage = function($name) {
      echo "مرحبًا $name، نورت الموقع!";
  };
  $welcomeMessage("أحمد"); // يطبع: مرحبًا أحمد، نورت الموقع!
  ```

- **خاصية مهمة:**  
  يمكن للدوال المجهولة التقاط متغيرات من خارجها باستخدام الكلمة المفتاحية `use`:
  ```php
  $discount = 50;
  $applyDiscount = function($price) use ($discount) {
      return $price - $discount;
  };
  echo $applyDiscount(200); // يطبع: 150 (أي 200 - 50)
  ```

- **متى تستخدمها؟**  
  عند الحاجة لدالة مؤقتة أو عند تمرير دالة كوسيلة (Callback)، مثل تصفية المصفوفات.

---

### ج. دوال الأسهم (Arrow Functions)
- **ما هي؟**  
  هي صيغة مختصرة للدوال المجهولة تم تقديمها في PHP 7.4. تُكتب باستخدام `fn` وتلتقط المتغيرات من السياق الخارجي تلقائيًا.
  
- **مثال واقعي:**  
  ضرب كل عدد في مصفوفة في 2:
  ```php
  $numbers = [1, 2, 3];
  $doubled = array_map(fn($n) => $n * 2, $numbers);
  print_r($doubled); // الناتج: [2, 4, 6]
  ```

- **لماذا تُسهل الحياة؟**  
  - لا تحتاج إلى كتابة كلمة `return`.
  - تلتقط المتغيرات من الخارج دون الحاجة لكتابة `use`.

- **متى تستخدمها؟**  
  للمهام البسيطة التي يمكن إنجازها في تعبير واحد، مثل العمليات على المصفوفات.

---

## 3. مقارنة سريعة بين الأنواع

| النوع               | الصياغة                         | التقاط المتغيرات | الاستخدام الشائع                          |
|---------------------|--------------------------------|------------------|-------------------------------------------|
| **الدوال العادية**   | `function myFunc() { ... }`     | يدوي             | مهام معقدة ومتعددة الخطوات                |
| **الدوال المجهولة**  | `$var = function() { ... };`    | عبر `use`        | تمرير الدوال كـ Callback، استخدامات مؤقتة  |
| **دوال الأسهم**     | `$var = fn() => ...;`           | تلقائي           | عمليات بسيطة مثل تحويل أو تصفية المصفوفات   |

---

## 4. أمثلة واقعية مبسطة

### مثال 1: تطبيق قائمة مطعم
- **المشكلة:** حساب الفاتورة النهائية للزبون مع احتساب الضريبة ورسوم الخدمة.
- **دالة عادية:**
  ```php
  function calculateBill($items) {
      $total = array_sum($items);
      $tax = $total * 0.15;
      $service = 10;
      return $total + $tax + $service;
  }
  echo calculateBill([50, 30, 20]); // يطبع: 132.5 (100 + 15 + 10)
  ```
*شرح:*  
تجمع الدالة أسعار الأطباق، ثم تضيف الضريبة ورسوم الخدمة للحصول على الفاتورة النهائية.

---

### مثال 2: لعبة أعداد
- **المشكلة:** التحقق من تخمين اللاعب لرقم سري.
- **دالة مجهولة:**
  ```php
  $secretNumber = 7;
  $checkGuess = function($guess) use ($secretNumber) {
      return $guess == $secretNumber ? "فوز!" : "حاول مرة أخرى";
  };
  echo $checkGuess(5); // يطبع: حاول مرة أخرى
  ```
*شرح:*  
تستخدم الدالة المجهولة لالتقاط الرقم السري من الخارج (باستخدام `use`) ومن ثم تقارن تخمين اللاعب بالرقم المطلوب.

---

### مثال 3: معالجة قائمة الأعداد باستخدام دوال الأسهم
- **المشكلة:** مضاعفة كل عدد في المصفوفة.
- **دالة سهم:**
  ```php
  $numbers = [1, 2, 3];
  $doubled = array_map(fn($n) => $n * 2, $numbers);
  print_r($doubled); // يطبع: [2, 4, 6]
  ```
*شرح:*  
باستخدام دالة سهم مختصرة مع `array_map`، يتم ضرب كل عنصر في المصفوفة في 2 بسرعة وسهولة.

---

## 5. الخلاصة

- **الدوال العادية:**  
  تُستخدم للمهام الكبيرة والمعقدة، حيث تحتاج إلى إعادة استخدامها في أماكن متعددة من البرنامج.

- **الدوال المجهولة:**  
  مفيدة في الحالات المؤقتة أو عند تمرير الدوال كوسيلة (Callback)، خاصةً عند الحاجة لالتقاط متغيرات من خارج الدالة.

- **دوال الأسهم:**  
  تُعتبر مثالية للعمليات البسيطة التي تتطلب تعبيرًا واحدًا، وتُسهل كتابة الكود بشكل مختصر وواضح.

**نصيحة أخيرة:**  
اختر نوع الدالة المناسب بناءً على حجم وتعقيد المهمة؛ إذا كانت بسيطة ومختصرة فاستخدم دوال الأسهم، أما إذا كانت العملية معقدة ومتعددة الخطوات فاستخدم الدوال العادية أو المجهولة.

بهذه الطريقة، تصبح دوال PHP أداة قوية لتنظيم كودك وتسهيل صيانته وإعادة استخدامه في تطبيقات واقعية.

