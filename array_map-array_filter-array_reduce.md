# التعامل مع المصفوفات في PHP باستخدام `array_map`، `array_filter`، و `array_reduce`

في PHP، هناك دوال متخصصة لمعالجة المصفوفات تعتمد على مفهوم **البرمجة الوظيفية** (Functional Programming). تُساعد هذه الدوال على تبسيط العمليات التي نقوم بها على المصفوفات مقارنةً باستخدام الحلقات التقليدية مثل `for` أو `foreach`.

---

## 1. ما هي هذه الدوال؟

### **`array_map()`**
- **الغرض:**  
  تقوم بتطبيق دالة معينة على كل عنصر من عناصر المصفوفة وتعيد مصفوفة جديدة تحتوي على النتائج.
- **التشبيه:**  
  تخيل أن لديك قائمة من العناصر وتريد تحويل كل عنصر منها إلى شكل آخر، مثل طباعة أسماء المنتجات بأحرف كبيرة.
  
---

### **`array_filter()`**
- **الغرض:**  
  تقوم بتصفية المصفوفة وإرجاع عناصرها التي تحقق شرطًا معينًا.
- **التشبيه:**  
  مثل استخدام مصفاة لتصفية الحصى، حيث تحتفظ فقط بالعناصر التي تفي بمعيار معين (مثل الأعداد الزوجية أو المنتجات ذات السعر العالي).

---

### **`array_reduce()`**
- **الغرض:**  
  تقوم بتجميع كل عناصر المصفوفة في قيمة واحدة (مثلاً حساب المجموع الكلي أو دمج النصوص).
- **التشبيه:**  
  تخيل أنك تجمع النقاط من كل لاعب في فريق للحصول على مجموع النقاط الكلي.

---

## 2. شرح كل دالة مع أمثلة واقعية

### أ. استخدام `array_map()` لتحويل عناصر المصفوفة

#### مثال 1: تحويل أسماء المنتجات إلى أحرف كبيرة
```php
$products = ["laptop", "phone", "tablet"];
$uppercaseProducts = array_map(fn($product) => strtoupper($product), $products);
print_r($uppercaseProducts); 
// الناتج: ["LAPTOP", "PHONE", "TABLET"]
```
*شرح:*  
يتم تطبيق دالة `strtoupper()` على كل عنصر من عناصر المصفوفة لجعل كل الحروف كبيرة. هذا يساعد في توحيد تنسيق البيانات.

#### مثال 2: حساب مربع كل عدد
```php
$numbers = [1, 2, 3, 4];
$squares = array_map(fn($n) => $n * $n, $numbers);
print_r($squares); 
// الناتج: [1, 4, 9, 16]
```
*شرح:*  
تقوم الدالة بضرب كل رقم في نفسه وتعيد مصفوفة جديدة تحتوي على مربعات الأرقام.

---

### ب. استخدام `array_filter()` لتصفية عناصر المصفوفة

#### مثال 1: تصفية الأعداد الزوجية
```php
$numbers = [1, 2, 3, 4, 5];
$evenNumbers = array_filter($numbers, fn($n) => $n % 2 == 0);
print_r($evenNumbers); 
// الناتج: [2, 4]
```
*شرح:*  
يتم فحص كل رقم، وإذا كان الرقم زوجيًا (أي باقي قسمته على 2 يساوي صفرًا) يتم الاحتفاظ به في المصفوفة الناتجة.

#### مثال 2: تصفية المنتجات ذات السعر الأكبر من 1000
```php
$products = [
    ["name" => "لابتوب", "price" => 1500],
    ["name" => "هاتف", "price" => 800],
];
$expensiveProducts = array_filter($products, fn($p) => $p["price"] > 1000);
print_r($expensiveProducts); 
// الناتج: يظهر اللابتوب فقط
```
*شرح:*  
يتم المرور على كل عنصر من عناصر المصفوفة، ويتم الاحتفاظ فقط بالعناصر التي يحقق سعرها الشرط المطلوب (أكبر من 1000).

---

### ج. استخدام `array_reduce()` لتجميع عناصر المصفوفة

#### مثال 1: حساب مجموع الأعداد
```php
$numbers = [10, 20, 30];
$sum = array_reduce($numbers, fn($carry, $n) => $carry + $n, 0);
echo $sum; 
// الناتج: 60
```
*شرح:*  
تبدأ الدالة بقيمة أولية (0 في هذه الحالة) ثم تضيف قيمة كل عنصر إلى المتغير التراكمي `$carry`، وفي النهاية تحصل على مجموع جميع العناصر.

#### مثال 2: دمج عناصر المصفوفة في جملة نصية
```php
$words = ["مرحبًا", "كيف", "حالك"];
$sentence = array_reduce($words, fn($carry, $word) => $carry . " " . $word, "");
echo $sentence; 
// الناتج: " مرحبًا كيف حالك"
```
*شرح:*  
يتم دمج كل كلمة مع الكلمة السابقة لتكوين جملة واحدة. تبدأ العملية بسلسلة فارغة ثم تضاف الكلمات واحدة تلو الأخرى مع فراغ بينها.

---

## 3. مقارنة مع الحلقات التقليدية

| الدالة            | باستخدام الحلقات (مثل `foreach`)    | الفرق الأساسي                           |
|-------------------|-------------------------------------|-----------------------------------------|
| `array_map`       | كتابة حلقة لتعديل كل عنصر           | كود أقصر وأكثر وضوحًا لتعديل المصفوفة    |
| `array_filter`    | استخدام شرط داخل حلقة لتحديد العناصر | تُبسط عملية التصفية دون كتابة شروط معقدة |
| `array_reduce`    | تجميع القيم باستخدام حلقة متكررة     | تسهل عمليات التجميع والتراكم             |

*شرح:*  
هذه الدوال تُبسط الكود وتجعل عمليات التكرار والتصفية والتجميع أكثر وضوحًا وسهولة مقارنةً باستخدام الحلقات التقليدية.

---

## 4. أمثلة متكاملة من الواقع

### مثال 1: معالجة بيانات الطلاب
لنفترض أن لدينا قائمة ببيانات الطلاب مع علاماتهم، ونريد:
- تحويل العلامات إلى تقديرات (مثلاً: ممتاز، جيد جدًا، جيد).
- تصفية الطلاب الذين حصلوا على تقدير "ممتاز".
- حساب متوسط العلامات.

```php
$students = [
    ["name" => "أحمد", "grade" => 85],
    ["name" => "ليلى", "grade" => 92],
    ["name" => "محمد", "grade" => 78],
];

// 1. تحويل العلامات إلى تقديرات باستخدام array_map
$grades = array_map(function($student) {
    return [
        "name" => $student["name"],
        "grade" => $student["grade"] >= 90 ? "ممتاز" : ($student["grade"] >= 80 ? "جيد جدًا" : "جيد")
    ];
}, $students);

// 2. تصفية الطلاب الذين حصلوا على تقدير "ممتاز" باستخدام array_filter
$excellentStudents = array_filter($grades, fn($s) => $s["grade"] == "ممتاز");

// 3. حساب مجموع العلامات باستخدام array_reduce
$total = array_reduce($students, fn($carry, $s) => $carry + $s["grade"], 0);
$average = $total / count($students);

print_r($excellentStudents); // ستظهر بيانات الطالب الذي حصل على "ممتاز" (ليلى)
echo "المتوسط: " . $average; // يطبع المتوسط: 85
```
*شرح:*  
تُظهر هذه الأمثلة كيفية تحويل البيانات وتصفية النتائج وحساب المتوسط بسهولة باستخدام دوال معالجة المصفوفات.

---

### مثال 2: عربة التسوق
لنفترض أن لدينا عربة تسوق تحتوي على عناصر مع سعر كل عنصر وعدد الكميات، ونريد:
- حساب السعر الإجمالي لكل عنصر.
- تصفية العناصر التي يكون سعرها الإجمالي أكبر من قيمة معينة.
- حساب إجمالي السعر للعربة بأكملها.

```php
$cart = [
    ["name" => "لابتوب", "price" => 1500, "quantity" => 2],
    ["name" => "ماوس", "price" => 25, "quantity" => 1],
];

// 1. حساب السعر الإجمالي لكل عنصر باستخدام array_map
$itemTotals = array_map(fn($item) => $item["price"] * $item["quantity"], $cart);

// 2. تصفية العناصر باهظة الثمن باستخدام array_filter
$expensiveItems = array_filter($itemTotals, fn($total) => $total > 1000);

// 3. حساب الإجمالي النهائي باستخدام array_reduce
$total = array_reduce($itemTotals, fn($carry, $t) => $carry + $t, 0);

print_r($itemTotals);     // الناتج: [3000, 25]
print_r($expensiveItems);  // الناتج: [3000]
echo "الإجمالي: $" . $total;  // يطبع: الإجمالي: $3025
```
*شرح:*  
تعرض الأمثلة كيف يمكن حساب الأسعار الإجمالية للعناصر، تصفية العناصر ذات القيمة العالية، وتجميع الأسعار للوصول إلى الإجمالي النهائي للعربة.

---

## 5. الخلاصة

- **`array_map`** تُستخدم لتعديل أو تحويل كل عنصر من عناصر المصفوفة.
- **`array_filter`** تُستخدم لتصفية المصفوفة واختيار العناصر التي تفي بشرط معين.
- **`array_reduce`** تُستخدم لتجميع عناصر المصفوفة في قيمة واحدة (مثل المجموع أو التجميع النصي).

**نصيحة:**  
عند التعامل مع المصفوفات، حاول استخدام هذه الدوال للحصول على كود أكثر نظافة ووضوحًا، خاصةً عند الحاجة لإجراء عمليات تحويل أو تصفية أو تجميع للبيانات.

---

بهذا الشكل، يمكنك معالجة المصفوفات في PHP بأسلوب وظيفي أنيق ومبسّط يجعل كودك أسهل في القراءة والصيانة.
