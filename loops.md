
# شرح الدورات التكرارية في PHP وأوامر التحكم

## مقدمة

تُعد الدورات التكرارية (Loops) من الأدوات الأساسية في لغات البرمجة، بما في ذلك PHP. تسمح لك بتنفيذ كتلة من التعليمات البرمجية بشكل متكرر طالما تحقق شرط معين. في هذا الملف، سنتناول أنواع الدورات المختلفة في PHP (`while`, `do while`, `for`, `foreach`) بالإضافة إلى أوامر التحكم في سير الدورة (`break` و `continue`)، مع أمثلة عملية وحقيقية لكل منها.

## 1. حلقة While

### الاستخدام      

تُستخدم حلقة `while` لتكرار كتلة من التعليمات البرمجية طالما أن الشرط المحدد صحيح (True). يتم فحص الشرط **قبل** كل تكرار. إذا كان الشرط خاطئًا في البداية، فلن يتم تنفيذ كتلة التعليمات البرمجية ولا مرة واحدة.

### مثال عملي: قراءة بيانات من ملف حتى نهاية الملف

**المشكلة:** لديك ملف نصي يحتوي على بيانات (مثل قائمة أسماء أو أرقام)، وتريد قراءة كل سطر وطباعته دون معرفة عدد السطور مسبقًا.

**الحل:** استخدام `while` لأنها تستمر في التكرار طالما أن الشرط (لم نصل إلى نهاية الملف) متحقق.

```php
<?php
$file = fopen("data.txt", "r"); // فتح ملف للقراءة

if ($file) { // التأكد من فتح الملف بنجاح
    while (!feof($file)) { // استمرار القراءة طالما لم نصل إلى نهاية الملف
        $line = fgets($file); // قراءة سطر واحد من الملف
        echo $line; // طباعة السطر المقروء
    }
    fclose($file); // إغلاق الملف بعد الانتهاء
} else {
    echo "Unable to open the file."; // في حالة فشل فتح الملف
}
?>
```

**الشرح:**

*   `$file = fopen("data.txt", "r");`: يتم فتح الملف `data.txt` في وضع القراءة (`"r"`).
*   `if ($file) { ... }`:  نتحقق أولاً إذا تم فتح الملف بنجاح. إذا فشل `fopen` في فتح الملف (مثلاً، الملف غير موجود)، فسيعيد `false`.
*   `while (!feof($file)) { ... }`: تبدأ حلقة `while`. `feof($file)` هي دالة PHP تتحقق مما إذا كان "مؤشر الملف" قد وصل إلى نهاية الملف. `!feof($file)` يعني "طالما لم نصل إلى نهاية الملف".
*   `$line = fgets($file);`: في كل تكرار، تقرأ الدالة `fgets($file)` سطرًا واحدًا من الملف وتعيده، ثم يتم تخزينه في المتغير `$line`.
*   `echo $line;`: يتم طباعة السطر المقروء.
*   `fclose($file);`: بعد الانتهاء من القراءة، من المهم إغلاق الملف باستخدام `fclose($file)` لتحرير الموارد.
*   `else { echo "Unable to open the file."; }`: في حالة فشل فتح الملف، يتم عرض رسالة خطأ.

## 2. حلقة Do While

### الاستخدام

تشبه حلقة `do while` حلقة `while`، ولكن الفرق الرئيسي هو أن الشرط يتم فحصه **بعد** تنفيذ كتلة التعليمات البرمجية في كل تكرار. هذا يضمن أن كتلة التعليمات البرمجية ستنفذ **مرة واحدة على الأقل**، حتى لو كان الشرط خاطئًا في البداية.

### مثال عملي: طلب إدخال صحيح من المستخدم

**المشكلة:** تريد من المستخدم إدخال رقم بين 1 و10، ويجب أن يستمر البرنامج في طلب الإدخال حتى يكون الرقم صحيحًا.

**الحل:** استخدام `do while` لأنها تضمن تنفيذ الكود مرة واحدة على الأقل قبل التحقق من الشرط.

```php
<?php
do {
    $input = readline("أدخل رقمًا بين 1 و 10: "); // طلب إدخال من المستخدم
    // التحقق مما إذا كان الإدخال رقمي
    if (!is_numeric($input)) {
        echo "الإدخال غير صحيح. يجب أن يكون رقمًا.\n";
        $input = null; // إعادة تعيين الإدخال لإعادة التكرار
        continue; // العودة إلى بداية الحلقة
    }
    $input = intval($input); // تحويل الإدخال إلى عدد صحيح
    if ($input < 1 || $input > 10) {
        echo "الرقم خارج النطاق المسموح به (1-10). حاول مرة أخرى.\n";
    }
} while ($input === null || $input < 1 || $input > 10); // التكرار إذا كان الإدخال غير صحيح أو خارج النطاق

echo "شكرًا! لقد أدخلت: " . $input . "\n";
?>
```

**الشرح:**

*   `do { ... } while (condition);`: هيكل حلقة `do while`. كتلة التعليمات البرمجية داخل `do { ... }` ستنفذ أولاً.
*   `$input = readline("أدخل رقمًا بين 1 و 10: ");`: يطلب من المستخدم إدخال رقم عبر سطر الأوامر ويخزن الإدخال في `$input`.
*   `if (!is_numeric($input)) { ... }`: يتم التحقق مما إذا كان الإدخال رقميًا باستخدام `is_numeric()`. إذا لم يكن رقمًا، يتم عرض رسالة خطأ، وتعيين `$input` إلى `null`، واستخدام `continue` للعودة إلى بداية الحلقة وإعادة طلب الإدخال.
*   `$input = intval($input);`: يتم تحويل الإدخال إلى عدد صحيح باستخدام `intval()`.
*   `if ($input < 1 || $input > 10) { ... }`: يتم التحقق مما إذا كان الرقم ضمن النطاق المطلوب (1-10). إذا كان خارج النطاق، يتم عرض رسالة خطأ.
*   `while ($input === null || $input < 1 || $input > 10);`: الشرط الذي يتم فحصه بعد كل تكرار. تستمر الحلقة في التكرار طالما أن `$input` هو `null` (بسبب إدخال غير رقمي) أو إذا كان الرقم أقل من 1 أو أكبر من 10.
*   `echo "شكرًا! لقد أدخلت: " . $input . "\n";`: بعد الخروج من الحلقة (عندما يكون الإدخال صحيحًا)، يتم عرض رسالة شكر مع الرقم المدخل.

## 3. حلقة For

### الاستخدام

تُستخدم حلقة `for` عندما يكون عدد التكرارات معروفًا مسبقًا أو يمكن تحديده بسهولة. تتكون حلقة `for` من ثلاثة أجزاء رئيسية:

1.  **التهيئة (Initialization):** يتم تنفيذها مرة واحدة فقط في بداية الحلقة. غالبًا ما تستخدم لتهيئة متغير العداد.
2.  **الشرط (Condition):** يتم فحصه قبل كل تكرار. تستمر الحلقة في التكرار طالما أن الشرط صحيح.
3.  **الزيادة/النقصان (Increment/Decrement):** يتم تنفيذه بعد كل تكرار. غالبًا ما يستخدم لتحديث متغير العداد.

### مثال عملي: طباعة جدول ضرب لعدد معين

**المشكلة:** تحتاج إلى طباعة جدول ضرب لعدد معين (مثل 5) من 1 إلى 10.

**الحل:** استخدام `for` لأن عدد التكرارات معروف مسبقًا (10 مرات).

```php
<?php
$number = 5;
echo "جدول ضرب العدد $number:\n";
for ($i = 1; $i <= 10; $i++) { // التكرار من 1 إلى 10
    $product = $number * $i; // حساب حاصل الضرب
    echo "$number x $i = $product\n"; // طباعة السطر في الجدول
}
?>
```

**الشرح:**

*   `$number = 5;`: تحديد العدد الذي سيتم إنشاء جدول الضرب له.
*   `echo "جدول ضرب العدد $number:\n";`: طباعة عنوان الجدول.
*   `for ($i = 1; $i <= 10; $i++) { ... }`: حلقة `for`.
    *   `$i = 1;`: التهيئة: يتم تهيئة متغير العداد `$i` بالقيمة 1.
    *   `$i <= 10;`: الشرط: تستمر الحلقة في التكرار طالما أن `$i` أقل من أو يساوي 10.
    *   `$i++`: الزيادة: بعد كل تكرار، يتم زيادة قيمة `$i` بمقدار 1.
*   `$product = $number * $i;`: حساب حاصل ضرب العدد `$number` في قيمة العداد `$i`.
*   `echo "$number x $i = $product\n";`: طباعة سطر واحد من جدول الضرب، يوضح العملية والنتيجة.

## 4. حلقة Foreach

### الاستخدام

تُستخدم حلقة `foreach` خصيصًا للتكرار على عناصر المصفوفات والكائنات. توفر طريقة سهلة ومريحة للوصول إلى كل عنصر في المصفوفة أو الكائن دون الحاجة إلى إدارة مؤشرات أو عدادات يدوية.

### مثال عملي: حساب مجموع عناصر مصفوفة

**المشكلة:** لديك مصفوفة تحتوي على أرقام، وتريد حساب مجموعها دون الحاجة إلى معرفة عدد العناصر.

**الحل:** استخدام `foreach` لأنها مصممة للتكرار على عناصر المصفوفات بسهولة.

```php
<?php
$numbers = [10, 20, 30, 40, 50];
$sum = 0; // تهيئة متغير المجموع

echo "الأرقام في المصفوفة: " . implode(", ", $numbers) . "\n"; // طباعة عناصر المصفوفة

foreach ($numbers as $number) { // التكرار على كل عنصر في المصفوفة
    $sum += $number; // إضافة العنصر الحالي إلى المجموع
}

echo "المجموع الكلي للأرقام: " . $sum . "\n"; // طباعة المجموع النهائي
?>
```

**الشرح:**

*   `$numbers = [10, 20, 30, 40, 50];`: تعريف مصفوفة `$numbers` تحتوي على مجموعة من الأرقام.
*   `$sum = 0;`: تهيئة متغير `$sum` بالقيمة 0 لتخزين المجموع.
*   `echo "الأرقام في المصفوفة: " . implode(", ", $numbers) . "\n";`: طباعة عناصر المصفوفة باستخدام `implode()` لفصل العناصر بفاصلة.
*   `foreach ($numbers as $number) { ... }`: حلقة `foreach`.
    *   `$numbers as $number`: لكل عنصر في المصفوفة `$numbers`، يتم تعيين قيمة العنصر الحالي إلى المتغير `$number` في كل تكرار.
*   `$sum += $number;`: في كل تكرار، يتم إضافة قيمة `$number` (العنصر الحالي من المصفوفة) إلى المتغير `$sum`.
*   `echo "المجموع الكلي للأرقام: " . $sum . "\n";`: بعد انتهاء الحلقة، يتم طباعة المجموع النهائي المخزن في `$sum`.

## 5. أمر Break

### الاستخدام

يُستخدم أمر `break` للخروج من حلقة تكرارية (مثل `while`, `do while`, `for`, `foreach`) بشكل فوري. عند تنفيذ `break` داخل حلقة، يتوقف تنفيذ الحلقة تمامًا، ويستمر البرنامج في تنفيذ التعليمات البرمجية التي تلي الحلقة مباشرة.

### مثال عملي: إيقاف البحث عند العثور على عنصر

**المشكلة:** لديك مصفوفة من الأرقام وتريد البحث عن رقم معين (مثل 30)، وإيقاف البحث بمجرد العثور عليه لتوفير الوقت.

**الحل:** استخدام `break` داخل دورة `foreach` لإنهاء التكرار مبكرًا عند العثور على العنصر.

```php
<?php
$numbers = [10, 20, 30, 40, 50];
$search = 30;
$found = false; // متغير لتتبع ما إذا تم العثور على الرقم

echo "البحث عن الرقم $search في المصفوفة...\n";

foreach ($numbers as $number) {
    echo "جاري الفحص: $number\n";
    if ($number === $search) {
        echo "تم العثور على الرقم $search!\n";
        $found = true;
        break; // إيقاف الدورة عند العثور على العنصر
    }
}

if (!$found) {
    echo "الرقم $search غير موجود في المصفوفة.\n";
}
?>
```

**الشرح:**

*   `$numbers = [10, 20, 30, 40, 50];`: تعريف مصفوفة `$numbers` تحتوي على الأرقام التي سيتم البحث فيها.
*   `$search = 30;`: تحديد الرقم الذي يتم البحث عنه.
*   `$found = false;`: تهيئة متغير `$found` إلى `false`. سيتم تغييره إلى `true` إذا تم العثور على الرقم.
*   `echo "البحث عن الرقم $search في المصفوفة...\n";`: طباعة رسالة بدء البحث.
*   `foreach ($numbers as $number) { ... }`: حلقة `foreach` للتكرار على عناصر المصفوفة.
*   `echo "جاري الفحص: $number\n";`: طباعة الرقم الحالي الذي يتم فحصه.
*   `if ($number === $search) { ... }`:  التحقق مما إذا كان الرقم الحالي `$number` يساوي الرقم المطلوب `$search`.
    *   `echo "تم العثور على الرقم $search!\n";`: إذا تم العثور على الرقم، يتم طباعة رسالة نجاح.
    *   `$found = true;`: يتم تعيين `$found` إلى `true` للإشارة إلى أنه تم العثور على الرقم.
    *   `break;`: يتم استخدام `break` للخروج من حلقة `foreach` فورًا.
*   `if (!$found) { ... }`: بعد انتهاء الحلقة (أو الخروج منها باستخدام `break`)، يتم التحقق من قيمة `$found`. إذا كانت لا تزال `false`، فهذا يعني أن الرقم لم يتم العثور عليه، ويتم طباعة رسالة مناسبة.

## 6. أمر Continue

### الاستخدام

يُستخدم أمر `continue` لتخطي التكرار الحالي في حلقة تكرارية والانتقال مباشرة إلى بداية التكرار التالي. على عكس `break` الذي ينهي الحلقة بالكامل، `continue` يتخطى فقط الجزء المتبقي من التكرار الحالي ويستمر في التكرارات التالية.

### مثال عملي: تخطي الأرقام الفردية وطباعة الزوجية

**المشكلة:** تريد طباعة الأرقام الزوجية فقط من مجموعة أرقام، متجاهلاً الأرقام الفردية.

**الحل:** استخدام `continue` لتخطي التكرارات غير المرغوب فيها (عندما يكون الرقم فرديًا).

```php
<?php
$numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

echo "الأرقام الزوجية من المصفوفة:\n";

foreach ($numbers as $number) {
    if ($number % 2 !== 0) { // إذا كان الرقم فرديًا (باقي القسمة على 2 لا يساوي 0)
        continue; // تخطي هذا التكرار وانتقل إلى الرقم التالي
    }
    echo $number . " "; // طباعة الرقم الزوجي
}
echo "\n";
?>
```

**الشرح:**

*   `$numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];`: تعريف مصفوفة `$numbers` تحتوي على الأرقام التي سيتم فحصها.
*   `echo "الأرقام الزوجية من المصفوفة:\n";`: طباعة عنوان للنتيجة.
*   `foreach ($numbers as $number) { ... }`: حلقة `foreach` للتكرار على عناصر المصفوفة.
*   `if ($number % 2 !== 0) { ... }`: التحقق مما إذا كان الرقم `$number` فرديًا باستخدام معامل باقي القسمة `%`. إذا كان `number % 2` لا يساوي 0، فهذا يعني أن الرقم فردي.
    *   `continue;`: إذا كان الرقم فرديًا، يتم تنفيذ `continue`. هذا يتسبب في تخطي الجزء المتبقي من الكود داخل حلقة `foreach` في هذا التكرار الحالي، والانتقال مباشرة إلى التكرار التالي (أي الرقم التالي في المصفوفة).
*   `echo $number . " ";`: إذا لم يتم تنفيذ `continue` (أي إذا كان الرقم ليس فرديًا، وبالتالي زوجيًا)، يتم طباعة الرقم متبوعًا بمسافة.
*   `echo "\n";`: بعد انتهاء الحلقة، يتم طباعة سطر جديد للترتيب.

## أمثلة أكثر تعقيدًا

### 1. نظام قائمة تفاعلية (Menu) باستخدام do-while و switch-case

[تم شرح هذا المثال سابقاً في جزء "أمثلة أكثر تعقيدًا"]

### 2. معالجة بيانات الطلبات باستخدام foreach داخل foreach

[تم شرح هذا المثال سابقاً في جزء "أمثلة أكثر تعقيدًا"]

### 3. إنشاء مصفوفة (Matrix) وتلاعب بها باستخدام for و nested loops

[تم شرح هذا المثال سابقاً في جزء "أمثلة أكثر تعقيدًا"]

### 4. استخدام break و continue في معالجة قائمة مع شروط معقدة

[تم شرح هذا المثال سابقاً في جزء "أمثلة أكثر تعقيدًا"]

### 5. قراءة ملف سجل (log) والتوقف عند حدوث خطأ باستخدام while و break

[تم شرح هذا المثال سابقاً في جزء "أمثلة أكثر تعقيدًا"]

## ملخص

| نوع الحلقة/الأمر | الاستخدام الرئيسي                                                                 | متى تستخدم                                                                                                                               |
| :----------------- | :------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------- |
| `while`            | تكرار كتلة من التعليمات طالما أن الشرط صحيح.                                     | عندما لا تعرف عدد التكرارات مسبقًا، وتريد فحص الشرط قبل كل تكرار.                                                                          |
| `do while`         | تكرار كتلة من التعليمات طالما أن الشرط صحيح، مع ضمان التنفيذ مرة واحدة على الأقل. | عندما تريد تنفيذ الكود مرة واحدة على الأقل ثم التحقق من الشرط لتحديد ما إذا كنت ستكرر أم لا (مثل التحقق من صحة إدخال المستخدم).                 |
| `for`              | تكرار كتلة من التعليمات لعدد محدد من المرات.                                     | عندما تعرف عدد التكرارات مسبقًا أو يمكن تحديده بسهولة (مثل التكرار من رقم إلى رقم، أو عدد مرات محددة).                                 |
| `foreach`          | تكرار على عناصر المصفوفات والكائنات.                                               | عندما تحتاج إلى الوصول إلى كل عنصر في مصفوفة أو كائن بسهولة دون الحاجة إلى إدارة مؤشرات أو عدادات يدوية.                               |
| `break`            | الخروج من حلقة تكرارية بشكل فوري.                                                | عندما تحتاج إلى إنهاء حلقة مبكرًا بناءً على شرط معين (مثل العثور على عنصر بحث، أو حدوث خطأ).                                            |
| `continue`         | تخطي التكرار الحالي والانتقال إلى التكرار التالي.                                 | عندما تحتاج إلى تخطي بعض التكرارات بناءً على شرط معين دون إنهاء الحلقة بأكملها (مثل فلترة البيانات أو تجاهل حالات معينة في التكرار). |


```
